<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    {% set seo_data = get_blog_post_seo(post) %}
    {% include 'seo/meta_tags.html' %}
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user/blog/blog-post.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="{{ url_for('public.index') }}">
                <i class="fas fa-leaf me-2"></i>Lepsze Życie
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if menu_items %}
                        {% for item in menu_items %}
                            {% if item.is_active %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ item.url }}">{{ item.title }}</a>
                            </li>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% if current_user.is_authenticated %}
                        {% if current_user.is_admin %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.dashboard') }}">
                                <i class="fas fa-cog me-1"></i>Admin
                            </a>
                        </li>
                        {% endif %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('users.profile') }}">
                                <i class="fas fa-user me-1"></i>Profil
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.logout') }}">
                                <i class="fas fa-sign-out-alt me-1"></i>Wyloguj
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i>Zaloguj
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main style="padding-top: 80px;">
        <!-- Hero Section -->
        <section class="blog-post-hero">
            <div class="container">
                <div class="blog-post-hero-content text-center">
                    <!-- Post Header -->
                    <header class="mb-5">
                        <h1 class="blog-post-title">{{ post.title }}</h1>
                    </header>
                </div>
            </div>
        </section>

        <!-- Article Content -->
        <section class="blog-post-content">
            <div class="container">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="py-4">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('public.index') }}">Strona główna</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('blog.index') }}">Blog</a></li>
                        {% if primary_category %}
                            {% if primary_category.parent %}
                                <li class="breadcrumb-item"><a href="{{ get_category_url_with_hierarchy(primary_category.parent) }}">{{ primary_category.parent.title }}</a></li>
                            {% endif %}
                            <li class="breadcrumb-item"><a href="{{ get_category_url_with_hierarchy(primary_category) }}">{{ primary_category.title }}</a></li>
                        {% endif %}
                        <li class="breadcrumb-item active" aria-current="page">{{ post.title }}</li>
                    </ol>
                </nav>
                <!-- Featured Image -->
                {% if post.featured_image %}
                <div class="post-featured-image mb-4">
                    <img src="{{ post.featured_image }}" alt="{{ post.title }}">
                </div>
                {% endif %}
                
                <div class="row">
                    <!-- Main Content -->
                    <div class="col-lg-8">
                        <article class="blog-post-article">

                            <!-- Post Content -->
                            <div class="post-content">
                                {{ post.content|safe }}
                            </div>

                            <!-- Post Images Gallery -->
                            {% if post.images %}
                            <div class="post-images-gallery mb-5">
                                <h5 class="mb-3">Galeria zdjęć</h5>
                                <div class="row g-3" id="imagesGallery">
                                    {% for image in post.images %}
                                    <div class="col-md-4 col-sm-6">
                                        <div class="image-gallery-item" data-bs-toggle="modal" data-bs-target="#imageLightboxModal" 
                                             data-image-src="{{ image.image_url }}" data-image-caption="{{ image.caption or '' }}">
                                            <img src="{{ image.image_url }}" class="img-fluid rounded" alt="{{ image.alt_text or '' }}" 
                                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjhGQUZDIi8+CjxwYXRoIGQ9Ik0xMjUgMTAwTDE0MCA4NUwxNjAgMTAwTDE4MCA4MEwyMDAgMTAwVjEzMEgxMDBWMTAwWiIgZmlsbD0iI0QxRDVEQiIvPgo8L3N2Zz4K'">
                                            {% if image.caption %}
                                            <div class="image-caption-overlay">
                                                <small class="text-white">{{ image.caption }}</small>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}


                            <!-- Comments Section -->
                            {% if post.allow_comments %}
                            <div class="comments-section">
                                <h5 class="mb-4">Komentarze ({{ post.comments.count() }})</h5>
                                
                                <!-- Add Comment Form -->
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h6 class="card-title">Dodaj komentarz</h6>
                                        <form id="commentForm">
                                            <input type="hidden" name="post_id" value="{{ post.id }}">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="author_name" class="form-label">Nick lub imię *</label>
                                                    <input type="text" class="form-control" id="author_name" name="author_name" required>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="author_email" class="form-label">Email *</label>
                                                    <input type="email" class="form-control" id="author_email" name="author_email" required>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="content" class="form-label">Komentarz *</label>
                                                <textarea class="form-control" id="content" name="content" rows="4" required></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Dodaj komentarz</button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Comments List -->
                                {% if comments %}
                                <div class="comments-list">
                                    {% for comment in comments %}
                                    {% if not comment.parent_id %}
                                    <div class="comment-item mb-4" data-comment-id="{{ comment.id }}">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <h6 class="card-title mb-0 text-dark">
                                                        <i class="fas fa-user me-2 text-muted"></i>{{ comment.author_name }}
                                                    </h6>
                                                    <small class="text-muted">
                                                        <i class="fas fa-clock me-1"></i>{{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}
                                                    </small>
                                                </div>
                                                <p class="card-text mb-3">{{ comment.content }}</p>
                                                <div class="comment-actions">
                                                    <button class="btn btn-sm btn-outline-primary reply-btn" data-comment-id="{{ comment.id }}">
                                                        <i class="fas fa-reply me-1"></i>Odpowiedz
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Replies -->
                                        {% if comment.replies %}
                                        <div class="replies ms-4 mt-2">
                                            {% for reply in comment.replies %}
                                            <div class="reply-item mb-2">
                                                <div class="card border-start border-3 border-primary">
                                                    <div class="card-body py-2">
                                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                                            <h6 class="card-title mb-0 small text-primary">
                                                                <i class="fas fa-reply me-1"></i>{{ reply.author_name }}
                                                            </h6>
                                                            <small class="text-muted">{{ reply.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                                                        </div>
                                                        <p class="card-text small mb-0">{{ reply.content }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                        
                                        <!-- Reply Form (hidden by default) -->
                                        <div class="reply-form mt-3" style="display: none;">
                                            <div class="card border-primary">
                                                <div class="card-header bg-light">
                                                    <h6 class="card-title mb-0 text-primary">
                                                        <i class="fas fa-reply me-2"></i>Odpowiedz na komentarz
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <form class="reply-comment-form">
                                                        <input type="hidden" name="post_id" value="{{ post.id }}">
                                                        <input type="hidden" name="parent_id" value="{{ comment.id }}">
                                                        <div class="row">
                                                            <div class="col-md-6 mb-2">
                                                                <input type="text" class="form-control form-control-sm" name="author_name" placeholder="Nick lub imię" required>
                                                            </div>
                                                            <div class="col-md-6 mb-2">
                                                                <input type="email" class="form-control form-control-sm" name="author_email" placeholder="Email" required>
                                                            </div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <textarea class="form-control form-control-sm" name="content" rows="2" placeholder="Twoja odpowiedź..." required></textarea>
                                                        </div>
                                                        <div class="d-flex gap-2">
                                                            <button type="submit" class="btn btn-primary btn-sm">
                                                                <i class="fas fa-paper-plane me-1"></i>Wyślij odpowiedź
                                                            </button>
                                                            <button type="button" class="btn btn-outline-secondary btn-sm cancel-reply">Anuluj</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-comments fa-2x mb-2"></i>
                                    <p>Brak komentarzy. Bądź pierwszy!</p>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                        </article>
                    </div>

                    <!-- Sidebar -->
                    <div class="col-lg-4">
                        <div class="blog-sidebar">
                            <!-- Post Meta Info -->
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="mb-3">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Informacje o artykule
                                    </h5>
                                    <div class="post-meta-info">
                                        <div class="mb-3">
                                            <strong><i class="fas fa-user me-2"></i>Autor:</strong>
                                            <span class="text-muted">{{ post.author.first_name or post.author.email }}</span>
                                        </div>
                                        <div class="mb-3">
                                            <strong><i class="fas fa-calendar me-2"></i>Data publikacji:</strong>
                                            <span class="text-muted">{{ post.published_at.strftime('%d.%m.%Y') if post.published_at else post.created_at.strftime('%d.%m.%Y') }}</span>
                                        </div>
                                        {% if post.comments.count() > 0 %}
                                        <div class="mb-3">
                                            <strong><i class="fas fa-comments me-2"></i>Komentarze:</strong>
                                            <span class="text-muted">{{ post.comments.count() }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Categories -->
                            {% if categories %}
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="mb-3">
                                        <i class="fas fa-folder me-2"></i>
                                        Kategorie
                                    </h5>
                                    <ul class="list-unstyled mb-0">
                                        {% for category in categories %}
                                        <li class="mb-2">
                                            <a href="{{ url_for('blog.category_detail', slug=category.slug) }}" class="text-decoration-none">
                                                {{ category.title }}
                                                <span class="badge bg-secondary ms-2">{{ category.posts_count }}</span>
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Post Tags -->
                            {% if post.tags %}
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="mb-3">
                                        <i class="fas fa-tags me-2"></i>
                                        Tagi artykułu
                                    </h5>
                                    <div class="d-flex flex-wrap gap-2">
                                        {% for tag in post.tags %}
                                        <a href="{{ url_for('blog.tag_detail', slug=tag.slug) }}" class="badge bg-primary text-decoration-none tag-badge">
                                            {{ tag.name }}
                                        </a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Related Posts -->
                            {% if related_posts %}
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="mb-3">
                                        <i class="fas fa-newspaper me-2"></i>
                                        Podobne artykuły
                                    </h5>
                                    {% for related_post in related_posts %}
                                    <div class="mb-3">
                                        <h6 class="mb-1">
                                            <a href="{{ get_post_url_with_category(related_post) }}" class="text-decoration-none">
                                                {{ related_post.title }}
                                            </a>
                                        </h6>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar me-1"></i>
                                            {{ related_post.published_at.strftime('%d.%m.%Y') if related_post.published_at else related_post.created_at.strftime('%d.%m.%Y') }}
                                        </small>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}


                            <!-- Social Sharing -->
                            <div class="social-sharing">
                                <h5>Udostępnij artykuł:</h5>
                                <div class="d-flex gap-2 flex-wrap">
                                    <!-- Facebook -->
                                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url|urlencode }}&quote={{ (post.title + ' - ' + (post.excerpt or post.content[:100]|striptags))|urlencode }}" 
                                       target="_blank" class="btn btn-outline-primary btn-sm" title="Udostępnij na Facebook">
                                        <i class="fab fa-facebook-f me-1"></i>
                                        Facebook
                                    </a>
                                    
                                    <!-- Twitter/X -->
                                    <a href="https://twitter.com/intent/tweet?url={{ request.url|urlencode }}&text={{ (post.title + ' - ' + (post.excerpt or post.content[:100]|striptags))|urlencode }}&via={{ config.get('SITE_NAME', 'KlubLepszeZycie')|urlencode }}" 
                                       target="_blank" class="btn btn-outline-info btn-sm" title="Udostępnij na X (Twitter)">
                                        <i class="fab fa-x-twitter me-1"></i>
                                        X
                                    </a>
                                    
                                    <!-- LinkedIn -->
                                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url|urlencode }}&title={{ post.title|urlencode }}&summary={{ (post.excerpt or post.content[:100]|striptags)|urlencode }}" 
                                       target="_blank" class="btn btn-outline-primary btn-sm" title="Udostępnij na LinkedIn">
                                        <i class="fab fa-linkedin-in me-1"></i>
                                        LinkedIn
                                    </a>
                                    
                                    <!-- WhatsApp -->
                                    <a href="https://wa.me/?text={{ (post.title + ' - ' + (post.excerpt or post.content[:100]|striptags) + ' ' + request.url)|urlencode }}" 
                                       target="_blank" class="btn btn-outline-success btn-sm" title="Udostępnij na WhatsApp">
                                        <i class="fab fa-whatsapp me-1"></i>
                                        WhatsApp
                                    </a>
                                    
                                    <!-- Copy Link -->
                                    <button onclick="copyToClipboard('{{ request.url }}')" class="btn btn-outline-dark btn-sm" title="Skopiuj link">
                                        <i class="fas fa-copy me-1"></i>
                                        Kopiuj
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">{{ footer_settings.company_title or 'Klub Lepsze Życie' }}</h5>
                    <p class="text-light">{{ footer_settings.company_description or 'Dołącz do nas i zmień swoje życie na lepsze. Osiągnij sukces finansowy, zdrowie i szczęście w relacjach.' }}</p>
                </div>
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">{{ footer_settings.contact_title or 'Kontakt' }}</h5>
                    {% if footer_settings.contact_email %}
                    <p class="text-light mb-2">
                        <i class="fas fa-envelope me-2"></i>
                        <a href="mailto:{{ footer_settings.contact_email }}" class="text-light text-decoration-none">
                            {{ footer_settings.contact_email|replace('@', '[at]') }}
                        </a>
                    </p>
                    {% endif %}
                    {% if footer_settings.contact_phone %}
                    <p class="text-light mb-2">
                        <i class="fas fa-phone me-2"></i>
                        {{ footer_settings.contact_phone }}
                    </p>
                    {% endif %}
                </div>
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">{{ footer_settings.social_title or 'Śledź nas' }}</h5>
                    <div class="d-flex gap-3">
                        {% for social_link in active_social_links %}
                            <a href="{{ social_link.url }}" target="{{ social_link.target or '_blank' }}" rel="noopener noreferrer" class="text-white" title="{{ social_link.platform }}">
                                <i class="fab fa-{{ social_link.platform.lower() }} fa-2x"></i>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-light">&copy; 2024 {{ footer_settings.company_name or 'Klub Lepsze Życie' }}. Wszystkie prawa zastrzeżone.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    {% if footer_settings.show_privacy_policy %}
                        <a href="{{ url_for('public.privacy_policy') }}" class="text-light me-3">Polityka prywatności</a>
                    {% endif %}
                    {% if footer_settings.show_terms %}
                        <a href="{{ url_for('public.terms') }}" class="text-light">Regulamin</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/word-cloud.js') }}"></script>

<script>
// Comment form handling
document.getElementById('commentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    submitComment(this);
});

// Reply form handling
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('reply-btn')) {
        const commentId = e.target.getAttribute('data-comment-id');
        const replyForm = document.querySelector(`[data-comment-id="${commentId}"] .reply-form`);
        replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
    }
    
    if (e.target.classList.contains('cancel-reply')) {
        const replyForm = e.target.closest('.reply-form');
        replyForm.style.display = 'none';
    }
});

document.addEventListener('submit', function(e) {
    if (e.target.classList.contains('reply-comment-form')) {
        e.preventDefault();
        submitComment(e.target);
    }
});

function submitComment(form) {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    // Map form field names to expected API names
    const apiData = {
        post_id: data.post_id,
        name: data.author_name,
        email: data.author_email,
        content: data.content,
        parent_id: data.parent_id || null
    };
    
    fetch('{{ url_for("blog.add_comment") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(apiData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccess(data.message);
            form.reset();
            // Hide reply form if it's a reply
            if (form.classList.contains('reply-comment-form')) {
                form.closest('.reply-form').style.display = 'none';
            }
            // Reload page to show new comment
            setTimeout(() => location.reload(), 1000);
        } else {
            showError('Błąd: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Wystąpił błąd podczas dodawania komentarza');
    });
}

// Copy to clipboard function
function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
        // Use modern clipboard API
        navigator.clipboard.writeText(text).then(function() {
            showCopyNotification('Link skopiowany do schowka!');
        }).catch(function(err) {
            console.error('Could not copy text: ', err);
            fallbackCopyTextToClipboard(text);
        });
    } else {
        // Fallback for older browsers
        fallbackCopyTextToClipboard(text);
    }
}

function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    
    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopyNotification('Link skopiowany do schowka!');
        } else {
            showCopyNotification('Nie udało się skopiować linku', 'error');
        }
    } catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
        showCopyNotification('Nie udało się skopiować linku', 'error');
    }
    
    document.body.removeChild(textArea);
}

function showCopyNotification(message, type = 'success') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}
</script>

<!-- Image Lightbox Modal -->
<div class="modal fade" id="imageLightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="lightboxImageTitle">Obraz</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-0">
                <img id="lightboxImage" src="" class="img-fluid" alt="" style="max-height: 80vh; object-fit: contain;">
                <div id="lightboxCaption" class="text-white p-3" style="display: none;"></div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-outline-light" id="prevImageBtn" style="display: none;">
                    <i class="fas fa-chevron-left me-1"></i>Poprzedni
                </button>
                <button type="button" class="btn btn-outline-light" id="nextImageBtn" style="display: none;">
                    Następny<i class="fas fa-chevron-right ms-1"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Image Lightbox functionality
document.addEventListener('DOMContentLoaded', function() {
    const galleryItems = document.querySelectorAll('.image-gallery-item');
    const lightboxModal = new bootstrap.Modal(document.getElementById('imageLightboxModal'));
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxCaption = document.getElementById('lightboxCaption');
    const prevBtn = document.getElementById('prevImageBtn');
    const nextBtn = document.getElementById('nextImageBtn');
    
    let currentImageIndex = 0;
    let images = [];
    
    // Initialize images array
    galleryItems.forEach((item, index) => {
        images.push({
            src: item.dataset.imageSrc,
            caption: item.dataset.imageCaption
        });
        
        item.addEventListener('click', () => {
            currentImageIndex = index;
            showImage(currentImageIndex);
            lightboxModal.show();
        });
    });
    
    function showImage(index) {
        if (images.length === 0) return;
        
        const image = images[index];
        lightboxImage.src = image.src;
        lightboxImage.alt = image.caption || '';
        
        if (image.caption) {
            lightboxCaption.textContent = image.caption;
            lightboxCaption.style.display = 'block';
        } else {
            lightboxCaption.style.display = 'none';
        }
        
        // Show/hide navigation buttons
        prevBtn.style.display = images.length > 1 ? 'inline-block' : 'none';
        nextBtn.style.display = images.length > 1 ? 'inline-block' : 'none';
    }
    
    // Navigation
    prevBtn.addEventListener('click', () => {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        showImage(currentImageIndex);
    });
    
    nextBtn.addEventListener('click', () => {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        showImage(currentImageIndex);
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (lightboxModal._isShown) {
            if (e.key === 'ArrowLeft') {
                prevBtn.click();
            } else if (e.key === 'ArrowRight') {
                nextBtn.click();
            } else if (e.key === 'Escape') {
                lightboxModal.hide();
            }
        }
    });
});
</script>


