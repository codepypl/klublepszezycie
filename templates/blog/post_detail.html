{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ super() }}{% endblock %}
{% block description %}{{ post.excerpt or post.content[:160]|striptags }}{% endblock %}

{% block og_type %}article{% endblock %}
{% block og_title %}{{ post.title }}{% endblock %}
{% block og_description %}{{ post.excerpt or post.content[:160]|striptags }}{% endblock %}
{% block og_image %}{{ post.featured_image or url_for('static', filename='images/logo.png', _external=True) }}{% endblock %}

{% block twitter_title %}{{ post.title }}{% endblock %}
{% block twitter_description %}{{ post.excerpt or post.content[:160]|striptags }}{% endblock %}
{% block twitter_image %}{{ post.featured_image or url_for('static', filename='images/logo.png', _external=True) }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/blog/blog-post.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/social-sharing.css') }}">
{% endblock %}

{% block content %}
<!-- Blog Post Hero Section -->
<section class="blog-post-hero blog-page-container">
    <div class="container">
        <div class="blog-post-hero-content">
            <!-- Post Title -->
            <h1 class="blog-post-title">{{ post.title }}</h1>
            
            {% if post.excerpt %}
            <p class="blog-post-excerpt">{{ post.excerpt }}</p>
            {% endif %}
        </div>
    </div>
</section>

<!-- Breadcrumb -->
<div class="container py-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ url_for('public.index') }}">Strona główna</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ url_for('blog.index') }}">Blog</a>
            </li>
            {% if post.categories %}
            <li class="breadcrumb-item">
                <a href="{{ url_for('blog.category_detail', slug=post.categories[0].slug) }}">{{ post.categories[0].title }}</a>
            </li>
            {% endif %}
            <li class="breadcrumb-item active" aria-current="page">{{ post.title }}</li>
        </ol>
    </nav>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Featured Image -->
            {% if post.featured_image %}
            <div class="post-featured-image">
                <img src="{{ post.featured_image }}" alt="{{ post.title }}">
            </div>
            {% endif %}
            
            <!-- Blog Post Content -->
            <div class="blog-post-article">
                <div class="post-content">
                    {{ post.content|safe }}
                </div>
            </div>
            
            <!-- Social Sharing Section -->
            <div class="social-sharing" id="socialSharingContainer">
                <h5>Udostępnij ten artykuł</h5>
                <div id="socialSharingButtons"></div>
            </div>
            
            <!-- Tags and Categories -->
            {% if post.tags %}
            <div class="mt-4">
                <div class="post-tags-list">
                    {% for tag in post.tags %}
                        <a href="{{ url_for('blog.tag_detail', slug=tag.slug) }}" class="post-tag-badge">{{ tag.name }}</a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if post.categories %}
            <div class="mt-4">
                {% for category in post.categories %}
                    <a href="{{ url_for('blog.category_detail', slug=category.slug) }}" class="post-category-badge">{{ category.title }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="blog-sidebar">
                <!-- Post Meta Info -->
                <div class="card">
                    <div class="card-body">
                        <h5>Informacje o poście</h5>
                        <div class="post-meta-info">
                            <div class="mb-3">
                                <strong>Autor:</strong><br>
                                <span class="text-muted">{{ post.author.first_name if post.author else 'Klub Lepsze Życie' }}</span>
                            </div>
                            
                            {% if post.published_at %}
                            <div class="mb-3">
                                <strong>Data publikacji:</strong><br>
                                <span class="text-muted">{{ post.published_at.strftime('%d.%m.%Y') }}</span>
                            </div>
                            {% endif %}
                            
                            <div class="mb-3">
                                <strong>Czas czytania:</strong><br>
                                <span class="text-muted">{{ post.reading_time }} min</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Categories -->
                {% if post.categories %}
                <div class="card">
                    <div class="card-body">
                        <h5>Kategorie</h5>
                        <div class="post-tags-list">
                            {% for category in post.categories %}
                                <a href="{{ url_for('blog.category_detail', slug=category.slug) }}" class="post-category-badge">{{ category.title }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Tags -->
                {% if post.tags %}
                <div class="card">
                    <div class="card-body">
                        <h5>Tagi</h5>
                        <div class="post-tags-list">
                            {% for tag in post.tags %}
                                <a href="{{ url_for('blog.tag_detail', slug=tag.slug) }}" class="post-tag-badge">{{ tag.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/utils/social-sharing.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize social sharing for this blog post
    const postId = {{ post.id }};
    
    // Initialize social sharing
    window.socialSharing.init(postId).then(success => {
        if (success) {
            // Create sharing buttons
            window.socialSharing.createSharingButtons('socialSharingButtons');
            
            // Add some additional styling
            const container = document.getElementById('socialSharingContainer');
            if (container) {
                container.classList.add('social-sharing-widget');
            }
        } else {
            console.error('Failed to initialize social sharing');
            // Hide sharing section if initialization failed
            const container = document.getElementById('socialSharingContainer');
            if (container) {
                container.style.display = 'none';
            }
        }
    });
});
</script>
{% endblock %}