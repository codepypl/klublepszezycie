{% extends "base.html" %}

{% block title %}{{ config.get('SITE_NAME', 'Klub Lepsze Å»ycie') }}{% endblock %}

{% block description %}{{ config.get('SITE_DESCRIPTION', 'DoÅ‚Ä…cz do Klubu Lepsze Å»ycie i popraw swojÄ… sytuacjÄ™ finansowÄ…, zdrowie, relacje oraz naucz siÄ™ korzystaÄ‡ z AI.') }}{% endblock %}


{% block content %}
<!-- Hero Section -->
<section id="hero" class="hero-section position-relative overflow-hidden">
    <!-- Hero Background -->
    {% if next_event and next_event.hero_background %}
        {% if next_event.hero_background_type == 'video' %}
            <video class="hero-bg-video" autoplay muted loop>
                <source src="{{ next_event.hero_background }}" type="video/mp4">
            </video>
            {% else %}
                <div class="hero-bg-image" style="background-image: url('{{ next_event.hero_background }}');"></div>
            {% endif %}
    {% else %}
        <div class="hero-bg-image" style="background-image: url('{{ url_for('static', filename='images/hero/hero-bg.jpg') }}');"></div>
    {% endif %}
    
    <div class="container position-relative">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <!-- Event Status Alert -->
                {% if event_status == 'current' %}
                <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                    <i class="fas fa-play-circle me-2"></i>
                    <strong>ðŸŽ‰ Wydarzenie trwa teraz!</strong> DoÅ‚Ä…cz do nas!
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}
                
                <h1 class="display-4 fw-bold text-white mb-4" id="event-title">
                    {% if next_event %}{{ next_event.title }}{% else %}Klub Lepsze Å»ycie{% endif %}
                </h1>
                <div class="lead text-white mb-4" id="event-description">
                    {% if next_event %}
                        {% if next_event.description and next_event.description.strip() and next_event.description.strip() not in ['<p></p>', '<p><br/></p>', '<p><br></p>', '<p>&nbsp;</p>'] %}
                            {{ next_event.description|safe }}
                        {% else %}
                            DoÅ‚Ä…cz do naszego ekskluzywnego wydarzenia!
                        {% endif %}
                    {% else %}
                        DoÅ‚Ä…cz do Klubu Lepsze Å»ycie i odkryj sekrety sukcesu w finansach, zdrowiu i relacjach.
                    {% endif %}
                </div>
                
                    <!-- Countdown Timer or Live Status -->
                {% if next_event and event_status == 'upcoming' %}
                    <div class="countdown-timer mb-4" data-event-date="{% if next_event.event_date %}{{ next_event.event_date.isoformat() }}{% endif %}" data-event-end="{% if next_event.end_date %}{{ next_event.end_date.isoformat() }}{% endif %}">
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="countdown-item">
                                    <span class="countdown-number" id="days">00</span>
                                    <span class="countdown-label">Dni</span>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="countdown-item">
                                    <span class="countdown-number" id="hours">00</span>
                                    <span class="countdown-label">Godzin</span>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="countdown-item">
                                    <span class="countdown-number" id="minutes">00</span>
                                    <span class="countdown-label">Minut</span>
                        </div>
                    </div>
                            <div class="col-3">
                                <div class="countdown-item">
                                    <span class="countdown-number" id="seconds">00</span>
                                    <span class="countdown-label">Sekund</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% elif next_event and event_status == 'current' %}
                    <div class="live-event-status mb-4">
                        <div class="row text-center">
                            <div class="col-12">
                                <div class="live-indicator">
                                    <span class="badge bg-success fs-5 px-4 py-2">
                                        <i class="fas fa-broadcast-tower me-2"></i>
                                        WYDARZENIE TRWA TERAZ!
                                    </span>
                                </div>
                                <p class="text-white mt-3">
                                    <i class="fas fa-clock me-2"></i>
                                    ZakoÅ„czenie: {% if next_event.end_date %}{{ next_event.end_date.strftime('%d.%m.%Y o %H:%M') }}{% else %}Nie okreÅ›lono{% endif %}
                                </p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                    <div class="hero-cta">
                    {% if next_event %}
                        {% if event_status == 'current' %}
                        {% else %}
                        <!-- Wydarzenie przyszÅ‚e - moÅ¼liwoÅ›Ä‡ rejestracji -->
                        <button class="btn btn-primary btn-lg me-3 mb-3" data-bs-toggle="modal" data-bs-target="#eventRegistrationModal"
                                data-event-id="{{ next_event.id }}" data-event-title="{{ next_event.title }}"
                                onclick="console.log('ðŸ” Hero button clicked!', this);">
                            <i class="fas fa-calendar-check me-2"></i>
                            Zarezerwuj miejsce
                            </button>
                        <p class="text-light small">
                            <i class="fas fa-clock me-1"></i>
                            {% if next_event.event_date %}{{ next_event.event_date.strftime('%d.%m.%Y o %H:%M') }}{% else %}Data nie okreÅ›lona{% endif %}
                        </p>
                        {% endif %}
                    {% else %}
                        <a href="#contact" class="btn btn-primary btn-lg me-3 mb-3">
                            <i class="fas fa-envelope me-2"></i>
                            Skontaktuj siÄ™ z nami
                        </a>
                    {% endif %}
                </div>
                </div>
                <div class="col-lg-4">
                    <div class="hero-image-container text-center">
                        <div class="event-icon mb-4">
                            <i class="fas fa-calendar-check fa-5x text-warning"></i>
                        </div>
                        <div class="event-details text-white">
                        {% if next_event %}
                            <h5>{{ next_event.event_type }}</h5>
                            {% if next_event.location %}
                                <p><i class="fas fa-map-marker-alt me-2"></i>{{ next_event.location }}</p>
                            {% endif %}
                            {% if next_event.meeting_link and event_status != 'current' %}
                                <a href="{{ next_event.meeting_link }}" target="_blank" class="btn btn-warning btn-lg">
                                    <i class="fas fa-video me-2"></i>DoÅ‚Ä…cz do spotkania
                                </a>
                            {% endif %}
                        {% else %}
                            <h5>Klub Lepsze Å»ycie</h5>
                            <p><i class="fas fa-heart me-2"></i>Zmiana Å¼ycia na lepsze</p>
                        {% endif %}
                    </div>
            </div>
                </div>
            </div>
        </div>
</section>

<!-- Dynamic Sections Display -->
{% if sections %}
    {% for section in sections %}
        {% if section.name == 'benefits' %}
    <!-- Benefits Section -->
    <section id="benefits" class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5" data-aos="fade-up">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold text-primary mb-3">
                            {{ section.title }}
                        </h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead text-muted">{{ section.subtitle }}</p>
                    {% endif %}
                </div>
            </div>
            {% if benefits_items %}
                <div class="row g-4">
                    {% for item in benefits_items %}
                    <div class="col-md-6 col-lg-3" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                        <div class="card h-100 border-0 shadow-sm">
                            {% if item.image %}
                            <img src="{{ url_for('static', filename=item.image) }}" class="card-img-top" alt="{{ item.title }}" style="height: 200px; object-fit: cover;">
                            {% endif %}
                            <div class="card-body d-flex flex-column">
                                {% if item.icon %}
                                <div class="text-center mb-3">
                                    <i class="{{ item.icon }} fa-3x text-primary"></i>
                                </div>
                                {% endif %}
                                <h5 class="card-title text-center">{{ item.title }}</h5>
                                <p class="card-text text-muted flex-grow-1">{{ item.description }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
            {% if section.content %}
                <div class="row mt-5">
                    <div class="col-12">
                        {{ section.content|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
        {% elif section.name == 'about' %}
    <!-- About Section -->
    <section id="about" class="py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6" data-aos="fade-right">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold text-primary mb-4">{{ section.title }}</h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead mb-4">
                            {{ section.subtitle|safe }}
                        </p>
                    {% endif %}
                    {% if section.content %}
                        <div class="mb-4">
                            {{ section.content|safe }}
                        </div>
                    {% endif %}
                    {% if section.enable_pillars and section.pillars_data %}
                        <div class="pillars-grid">
                            {% set pillars = section.pillars_data|from_json %}
                            {% for pillar in pillars %}
                            {% set blog_link = generate_blog_link(pillar.blog_link) if pillar.blog_link else None %}
                            {% if blog_link %}
                            <a href="{{ blog_link }}" class="pillar-item-link">
                            {% endif %}
                            <div class="pillar-item">
                                <i class="fas fa-{{ pillar.icon }} fa-2x" style="color: {{ pillar.icon_color }};"></i>
                                <h5>{{ pillar.title }}</h5>
                                <p>{{ pillar.description }}</p>
                            </div>
                            {% if blog_link %}
                            </a>
                            {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="col-lg-6" data-aos="fade-left" data-aos-delay="200">
                    <div class="about-visual">
                        <img src="{{ url_for('static', filename='images/about/community.jpg') }}" alt="SpoÅ‚ecznoÅ›Ä‡" class="img-fluid rounded shadow" style="width: 100%; height: 400px; object-fit: cover;">
                        {% if section.enable_floating_cards and section.floating_cards_data %}
                            {% set floating_cards = section.floating_cards_data|from_json %}
                            {% for card in floating_cards %}
                            {% set blog_link = generate_blog_link(card.blog_link) if card.blog_link else None %}
                            {% if blog_link %}
                            <a href="{{ blog_link }}" class="floating-card-link">
                            {% endif %}
                            <div class="floating-card" data-aos="zoom-in" data-aos-delay="{{ card.delay }}" style="top: {{ card.position or 300 }}px;">
                                <i class="fas fa-{{ card.icon }} fa-4x" style="color: {{ card.icon_color }};"></i>
                                <h4>{{ card.title }}</h4>
                            </div>
                            {% if blog_link %}
                            </a>
                            {% endif %}
                            {% endfor %}
                            
                            <!-- Final text after floating cards -->
                            {% if section.final_text %}
                            <div class="floating-cards-final-text mt-4">
                                <p class="text-center">
                                    <strong>{{ section.final_text|safe }}</strong>
                                </p>
                            </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>
        {% elif section.name == 'testimonials' %}
    <!-- Testimonials Section -->
    <section id="testimonials" class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5" data-aos="fade-up">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold text-primary mb-3">{{ section.title }}</h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead text-muted">{{ section.subtitle }}</p>
                    {% endif %}
                </div>
            </div>
            {% if testimonials %}
                <div class="row g-4">
                    {% for testimonial in testimonials %}
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body">
                                <div class="testimonial-content mb-3">
                                    <p class="fst-italic">"{{ testimonial.content|safe }}"</p>
                                </div>
                                <div class="testimonial-rating mb-3">
                                    <div class="d-flex align-items-center">
                                        {% for i in range(5) %}
                                            {% if i < testimonial.rating %}
                                                <i class="fas fa-star text-warning"></i>
                                            {% else %}
                                                <i class="far fa-star text-muted"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="testimonial-author">
                                    <h6 class="fw-bold mb-1">{{ testimonial.author_name }}</h6>
                                    {% if testimonial.member_since %}
                                        <small class="text-muted">CzÅ‚onek od {{ testimonial.member_since }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
            {% if section.content %}
                <div class="row mt-5">
                    <div class="col-12">
                        {{ section.content|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
        {% elif section.name == 'faq' %}
    <!-- FAQ Section -->
    <section id="faq" class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5" data-aos="fade-up">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold text-primary mb-3">{{ section.title }}</h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead text-muted">{{ section.subtitle }}</p>
                    {% endif %}
                </div>
            </div>
            {% if faqs %}
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <div class="accordion" id="faqAccordion">
                            {% for faq in faqs %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading{{ loop.index }}">
                                    <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" 
                                            data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" 
                                            aria-expanded="{% if loop.first %}true{% else %}false{% endif %}" 
                                            aria-controls="collapse{{ loop.index }}">
                                        {{ faq.question }}
                                    </button>
                                </h2>
                                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" 
                                     aria-labelledby="heading{{ loop.index }}" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        {{ faq.answer|safe }}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if section.content %}
                <div class="row mt-5">
                    <div class="col-12">
                        {{ section.content|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
        {% elif section.name == 'timeline' %}
            {% if timeline_events %}
    <!-- Timeline Section -->
    <section id="timeline" class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5" data-aos="fade-up">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold text-primary mb-3">
                            {{ section.title }}
                        </h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead text-muted">{{ section.subtitle }}</p>
                    {% endif %}
                </div>
            </div>
            <div class="timeline">
                {% for event in timeline_events %}
                <div class="timeline-item" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                    <div class="timeline-marker">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-header">
                            <div class="timeline-title-section">
                                <h4 class="timeline-event-title">{{ event.title }}</h4>
                            </div>
                            <div class="timeline-meta">
                                <span class="badge bg-primary">{{ event.event_date.strftime('%d.%m.%Y') }}</span>
                                <span class="badge bg-secondary">{{ event.event_date.strftime('%H:%M') }}</span>
                                {% if event.location %}
                                    <span class="badge bg-info">{{ event.location }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="timeline-body">
                            {% if event.description and event.description.strip() and event.description.strip() not in ['<p></p>', '<p><br/></p>', '<p><br></p>', '<p>&nbsp;</p>'] %}
                                {{ event.description|safe }}
                            {% endif %}
                            {% if event.max_participants %}
                                <p class="text-muted small">
                                    <i class="fas fa-users me-1"></i>
                                    Maksymalnie {{ event.max_participants }} uczestnikÃ³w
                                </p>
                            {% endif %}
                        </div>
                        <div class="timeline-actions">
                            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#eventRegistrationModal"
                                    data-event-id="{{ event.id }}" data-event-title="{{ event.title }}">
                                <i class="fas fa-user-plus me-1"></i>
                                Zarejestruj siÄ™
                            </button>
                            {% if event.registration_link %}
                                <a href="{{ event.registration_link }}" class="btn btn-outline-primary btn-sm" target="_blank">
                                    <i class="fas fa-external-link-alt me-1"></i>
                                    WiÄ™cej informacji
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if section.content %}
                <div class="row mt-5">
                    <div class="col-12">
                        {{ section.content|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
            {% endif %}
        {% elif section.name == 'cta' %}
    <!-- CTA Section -->
    <section id="cta" class="py-5 bg-primary text-white">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center" data-aos="fade-up">
                    {% if section.title %}
                        <h2 class="display-5 fw-bold mb-4">{{ section.title }}</h2>
                    {% endif %}
                    {% if section.subtitle %}
                        <p class="lead mb-4">{{ section.subtitle }}</p>
                    {% endif %}
                    <!-- Club Registration Form - Always Available -->
                    <div class="registration-container">
                        <form id="clubRegistrationForm" class="registration-form">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control form-control-lg" name="first_name" placeholder="Twoje imiÄ™" required>
                                </div>
                                <div class="col-md-6">
                                    <input type="email" class="form-control form-control-lg" name="email" placeholder="TwÃ³j email" required>
                                </div>
                                <div class="col-12">
                                    <input type="tel" class="form-control form-control-lg" name="phone" placeholder="Telefon (opcjonalnie)">
                                </div>
                                <div class="col-12">
                                    <button type="submit" id="clubRegistrationBtn" class="btn btn-success btn-lg px-5 py-3">
                                        <i class="fas fa-users me-2"></i>
                                        DoÅ‚Ä…cz do Klubu Lepsze Å»ycie
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {% if section.content %}
                <div class="row mt-5">
                    <div class="col-12">
                        {{ section.content|safe }}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
        {% endif %}
    {% endfor %}
{% endif %}

<!-- Footer -->
<footer class="bg-dark text-white py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <h5 class="fw-bold mb-3">{{ footer_settings.company_title or 'Klub Lepsze Å»ycie' }}</h5>
                <p class="text-light">{{ footer_settings.company_description or 'DoÅ‚Ä…cz do nas i zmieÅ„ swoje Å¼ycie na lepsze. OsiÄ…gnij sukces finansowy, zdrowie i szczÄ™Å›cie w relacjach.' }}</p>
            </div>
            <div class="col-lg-4 mb-4">
                <h5 class="fw-bold mb-3">{{ footer_settings.contact_title or 'Kontakt' }}</h5>
                {% if footer_settings.contact_email %}
                <p class="text-light mb-2">
                    <i class="fas fa-envelope me-2"></i>
                    <a href="mailto:{{ footer_settings.contact_email }}" class="text-light text-decoration-none">
                        {{ footer_settings.contact_email|replace('@', '[at]') }}
                    </a>
                </p>
                {% endif %}
                {% if footer_settings.contact_phone %}
                <p class="text-light mb-2">
                    <i class="fas fa-phone me-2"></i>
                    {{ footer_settings.contact_phone }}
                </p>
                {% endif %}
            </div>
            <div class="col-lg-4 mb-4">
                <h5 class="fw-bold mb-3">{{ footer_settings.social_title or 'ÅšledÅº nas' }}</h5>
                <div class="d-flex gap-3">
                    {% for social_link in active_social_links %}
                        <a href="{{ social_link.url }}" target="{{ social_link.target or '_blank' }}" rel="noopener noreferrer" class="text-white" title="{{ social_link.platform }}">
                            <i class="fab fa-{{ social_link.icon or social_link.platform.lower() }} fa-2x"></i>
                        </a>
                    {% endfor %}
                    {% if not active_social_links %}
                        <span class="text-muted">Brak aktywnych linkÃ³w</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <hr class="my-4">
        <div class="row align-items-center">
            <div class="col-md-6">
                <p class="mb-0 text-light">&copy; 2024 {{ footer_settings.company_name or 'Klub Lepsze Å»ycie' }}. Wszystkie prawa zastrzeÅ¼one.</p>
            </div>
            <div class="col-md-6 text-md-end">
                {% if footer_settings.show_privacy_policy %}
                    <a href="{{ url_for('public.privacy_policy') }}" class="text-light me-3">Polityka prywatnoÅ›ci</a>
                {% endif %}
                {% if footer_settings.show_terms %}
                    <a href="{{ url_for('public.terms') }}" class="text-light">Regulamin</a>
                {% endif %}
            </div>
        </div>
    </div>
</footer>

<!-- Event Registration Modal -->
{% if next_event %}
<div class="modal fade" id="eventRegistrationModal" tabindex="-1" aria-labelledby="eventRegistrationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="eventRegistrationModalLabel">
                    {% if event_status == 'current' %}
                    <i class="fas fa-broadcast-tower me-2"></i>
                    Wydarzenie w toku
                    {% else %}
                    <i class="fas fa-calendar-check me-2"></i>
                    Zarezerwuj miejsce na wydarzenie
                    {% endif %}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="event-info mb-4 p-4 bg-light border rounded">
                    <h4 class="text-primary mb-3" id="modalEventTitle">
                        <i class="fas fa-calendar-check me-2"></i>
                        <span id="modalEventTitleText">Wybierz wydarzenie</span>
                    </h4>
                    
                    
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2">
                                <i class="fas fa-clock me-2 text-primary"></i>
                                <strong>RozpoczÄ™cie:</strong><br>
                                <span class="text-dark" id="modalEventStartDate">--</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2">
                                <i class="fas fa-clock me-2 text-primary"></i>
                                <strong>ZakoÅ„czenie:</strong><br>
                                <span class="text-dark" id="modalEventEndDate">--</span>
                            </p>
                        </div>
                    </div>
                    
                    <p class="mb-2">
                        <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                        <strong>Lokalizacja:</strong> <span class="text-dark" id="modalEventLocation">--</span>
                    </p>
                    
                    <!-- Link do spotkania bÄ™dzie wysÅ‚any w emailu 5 min przed spotkaniem -->
                </div>
                
                {% if event_status == 'current' %}
                <!-- Wydarzenie w toku - brak moÅ¼liwoÅ›ci rejestracji -->
                <div class="alert alert-warning text-center">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Wydarzenie w toku!</strong><br>
                    Rejestracja zostaÅ‚a zamkniÄ™ta. SprawdÅº nasze przyszÅ‚e wydarzenia.
                </div>
                {% else %}
                
                {% set registered_count = next_event.registrations|selectattr('status', 'equalto', 'confirmed')|list|length %}
                <form id="eventRegistrationForm">
                    <input type="hidden" id="modalEventId" name="event_id" value="{{ next_event.id }}">
                    {% if next_event.max_participants %}
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-users me-2"></i>
                        <strong>DostÄ™pne miejsca:</strong> 
                        {{ registered_count }}/{{ next_event.max_participants }}
                        {% if registered_count >= next_event.max_participants %}
                            <span class="text-danger">(BRAK MIEJSC)</span>
                        {% else %}
                            <span class="text-success">({{ next_event.max_participants - registered_count }} miejsc pozostaÅ‚o)</span>
                        {% endif %}
                    </div>
                    {% endif %}
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label">ImiÄ™ *</label>
                            <input type="text" class="form-control form-control-lg" id="name" name="first_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email" class="form-control form-control-lg" id="email" name="email" required>
                        </div>
                        <div class="col-md-6">
                            <label for="phone" class="form-label">Telefon (opcjonalnie)</label>
                            <input type="tel" class="form-control form-control-lg" id="phone" name="phone">
                        </div>
                        <div class="col-md-6">
                            <!-- Puste miejsce dla lepszego layoutu -->
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="card border-success">
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="wants_club_news" name="wants_club_news" value="true" style="transform: scale(1.2);">
                                    <label class="form-check-label fw-bold text-success" for="wants_club_news">
                                        <i class="fas fa-users me-2"></i>
                                        <strong>ChcÄ™ doÅ‚Ä…czyÄ‡ do Klubu Lepsze Å»ycie</strong><br>
                                        <small class="text-muted">Otrzymasz hasÅ‚o tymczasowe i bÄ™dziesz dostawaÄ‡ informacje o przyszÅ‚ych wydarzeniach</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-grid">
                        {% if next_event.max_participants and registered_count >= next_event.max_participants %}
                        <button type="button" class="btn btn-secondary btn-lg" disabled>
                            <i class="fas fa-times me-2"></i>
                            Brak miejsc
                        </button>
                        {% else %}
                        <button type="submit" id="submitEventRegistration" class="btn btn-primary btn-lg">
                            <i class="fas fa-calendar-check me-2"></i>
                            Zarezerwuj miejsce
                        </button>
                        {% endif %}
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<!-- All JavaScript functionality moved to main.js -->
{% endblock %}