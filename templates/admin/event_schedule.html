{% extends "admin/base.html" %}

{% block title %}Harmonogram Wydarzeń{% endblock %}

{% block page_title %}
    <i class="fas fa-calendar-alt me-2"></i>Harmonogram Wydarzeń
{% endblock %}

{% block page_actions %}
                <div class="d-flex justify-content-end gap-2 mb-3">
                    <button class="btn admin-btn" onclick="showAddEventModal()">
                        <i class="fas fa-plus me-2"></i>
                        Dodaj Wydarzenie
                    </button>
                    <button class="btn admin-btn-danger" id="bulkDeleteBtn" style="display: none;">
                        <i class="fas fa-trash me-2"></i>
                        Usuń Zaznaczone
                    </button>
                </div>
{% endblock %}

{% block content %}
                <!-- Filters -->
                <div class="admin-card mb-4">
                    <div class="admin-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-filter me-2"></i>Filtry
                            <span class="badge bg-primary ms-2" id="activeFiltersCount" style="display: none;">0 aktywny</span>
                            <button class="btn btn-sm admin-btn-outline ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse">
                                <i class="fas fa-chevron-down" id="filtersIcon"></i>
                            </button>
                        </h5>
                    </div>
                    <div class="collapse" id="filtersCollapse">
                        <div class="admin-card-body">
                            <form id="filtersForm">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label for="searchInput" class="form-label">Wyszukaj</label>
                                        <input type="text" class="form-control" id="searchInput" placeholder="Wpisz tytuł, opis lub lokalizację...">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="archivedFilter" class="form-label">Status archiwalny</label>
                                        <select class="form-select" id="archivedFilter">
                                            <option value="false">Aktywne</option>
                                            <option value="true">Archiwalne</option>
                                            <option value="all">Wszystkie</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="publishedFilter" class="form-label">Status publikacji</label>
                                        <select class="form-select" id="publishedFilter">
                                            <option value="all">Wszystkie</option>
                                            <option value="true">Opublikowane</option>
                                            <option value="false">Nieopublikowane</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn admin-btn" id="applyFilters">
                                                <i class="fas fa-search me-2"></i>Filtruj
                                            </button>
                                            <button type="button" class="btn admin-btn-outline" id="clearFilters">
                                                <i class="fas fa-times me-2"></i>Wyczyść
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Events Table -->
                <div class="admin-card">
                    <div class="admin-card-body">
            <div id="eventsTableContainer">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Ładowanie...</span>
                    </div>
                    <p class="mt-2 text-muted">Ładowanie wydarzeń...</p>
                </div>
            </div>
            
            <!-- Pagination -->
            <div id="pagination" class="mt-3 pagination-container" 
                 data-show-info="true" 
                 data-show-per-page="true" 
                 data-default-per-page="10" 
                 data-max-visible-pages="5"></div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>Dodaj Nowe Wydarzenie
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addEventForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventTitle" class="form-label">Tytuł *</label>
                                <input type="text" class="form-control" id="eventTitle" name="title" required>
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="eventType" class="form-label">Typ Wydarzenia *</label>
                                <select class="form-select" id="eventType" name="event_type" required>
                                        <option value="">Wybierz typ</option>
                                    <option value="workshop">Warsztat</option>
                                    <option value="webinar">Webinar</option>
                                    <option value="meeting">Spotkanie</option>
                                    <option value="conference">Konferencja</option>
                                    <option value="other">Inne</option>
                                    </select>
                                </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventDate" class="form-label">Data Wydarzenia *</label>
                                <input type="date" class="form-control" id="eventDate" name="event_date" required min="">
                                    </div>
                            <div class="col-md-6 mb-3">
                                <label for="eventTime" class="form-label">Godzina *</label>
                                <input type="time" class="form-control" id="eventTime" name="event_time" required>
                                    </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="endDate" class="form-label">Data Zakończenia</label>
                                <input type="date" class="form-control" id="endDate" name="end_date" min="">
                                    </div>
                            <div class="col-md-6 mb-3">
                                <label for="endTime" class="form-label">Godzina Zakończenia</label>
                                <input type="time" class="form-control" id="endTime" name="end_time">
                                    </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventLocation" class="form-label">Lokalizacja</label>
                                <input type="text" class="form-control" id="eventLocation" name="location">
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="meetingLink" class="form-label">Link do Spotkania</label>
                                <input type="url" class="form-control" id="meetingLink" name="meeting_link">
                                </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="maxParticipants" class="form-label">Maksymalna Liczba Uczestników</label>
                                <input type="number" class="form-control" id="maxParticipants" name="max_participants" min="1">
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="heroBackgroundType" class="form-label">Typ Tła</label>
                                <select class="form-select" id="heroBackgroundType" name="hero_background_type">
                                    <option value="image">Obraz</option>
                                    <option value="video">Wideo</option>
                                </select>
                            </div>
                        </div>
                        
                                <div class="mb-3">
                            <label for="eventDescription" class="form-label">Opis</label>
                            <textarea class="form-control" id="eventDescription" name="description" rows="4" data-quill></textarea>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="eventActive" name="is_active" checked>
                                    <label class="form-check-label" for="eventActive">
                                            Aktywne
                                        </label>
                                    </div>
                                </div>
                            <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="eventPublished" name="is_published" checked>
                                    <label class="form-check-label" for="eventPublished">
                                        Opublikowane
                                        </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn admin-btn-outline" data-bs-dismiss="modal">Anuluj</button>
                        <button type="submit" class="btn admin-btn">Dodaj Wydarzenie</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div class="modal fade" id="editEventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Edytuj Wydarzenie
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="editEventForm">
                    <input type="hidden" id="editEventId" name="id">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEventTitle" class="form-label">Tytuł *</label>
                                <input type="text" class="form-control" id="editEventTitle" name="title" required>
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="editEventType" class="form-label">Typ Wydarzenia *</label>
                                <select class="form-select" id="editEventType" name="event_type" required>
                                    <option value="">Wybierz typ</option>
                                    <option value="workshop">Warsztat</option>
                                    <option value="webinar">Webinar</option>
                                    <option value="meeting">Spotkanie</option>
                                    <option value="conference">Konferencja</option>
                                    <option value="other">Inne</option>
                                    </select>
                                </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEventDate" class="form-label">Data Wydarzenia *</label>
                                <input type="date" class="form-control" id="editEventDate" name="event_date" required min="">
                                    </div>
                            <div class="col-md-6 mb-3">
                                <label for="editEventTime" class="form-label">Godzina *</label>
                                <input type="time" class="form-control" id="editEventTime" name="event_time" required>
                                    </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEndDate" class="form-label">Data Zakończenia</label>
                                <input type="date" class="form-control" id="editEndDate" name="end_date" min="">
                                    </div>
                            <div class="col-md-6 mb-3">
                                <label for="editEndTime" class="form-label">Godzina Zakończenia</label>
                                <input type="time" class="form-control" id="editEndTime" name="end_time">
                                    </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEventLocation" class="form-label">Lokalizacja</label>
                                <input type="text" class="form-control" id="editEventLocation" name="location">
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="editMeetingLink" class="form-label">Link do Spotkania</label>
                                <input type="url" class="form-control" id="editMeetingLink" name="meeting_link">
                                </div>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editMaxParticipants" class="form-label">Maksymalna Liczba Uczestników</label>
                                <input type="number" class="form-control" id="editMaxParticipants" name="max_participants" min="1">
                                </div>
                            <div class="col-md-6 mb-3">
                                <label for="editHeroBackgroundType" class="form-label">Typ Tła</label>
                                <select class="form-select" id="editHeroBackgroundType" name="hero_background_type">
                                    <option value="image">Obraz</option>
                                    <option value="video">Wideo</option>
                                </select>
                            </div>
                        </div>
                        
                                <div class="mb-3">
                            <label for="editEventDescription" class="form-label">Opis</label>
                            <textarea class="form-control" id="editEventDescription" name="description" rows="4" data-quill></textarea>
                                </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editEventActive" name="is_active">
                                    <label class="form-check-label" for="editEventActive">
                                            Aktywne
                                        </label>
                                    </div>
                                </div>
                            <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editEventPublished" name="is_published">
                                    <label class="form-check-label" for="editEventPublished">
                                        Opublikowane
                                        </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn admin-btn-outline" data-bs-dismiss="modal">Anuluj</button>
                        <button type="submit" class="btn admin-btn">Zapisz Zmiany</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Event Modal -->
    <div class="modal fade" id="deleteEventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Potwierdzenie Usunięcia
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Czy na pewno chcesz usunąć to wydarzenie? Tej operacji nie można cofnąć.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn admin-btn-outline" data-bs-dismiss="modal">Anuluj</button>
                    <button type="button" class="btn admin-btn-danger" id="confirmDeleteEvent">Usuń Wydarzenie</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin/events.js') }}?v={{ range(1000000, 9999999) | random }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set up pagination handlers for auto-initialization
            window.paginationHandlers = {
                onPageChange: (page) => {
                    // Events don't have server-side pagination, so this is just for UI
                    console.log('Page changed to:', page);
                },
                onPerPageChange: (newPage, perPage) => {
                    // Events don't have server-side pagination, so this is just for UI
                    console.log('Per page changed to:', perPage);
                }
            };

            // Initialize events manager
            window.eventsManager = new EventsManager();
        });
    </script>
{% endblock %}
