{% extends "admin/base.html" %}

{% block title %}Kampanie Emaili - Panel Admin{% endblock %}

{% block page_title %}
    <i class="fas fa-bullhorn me-2"></i>Kampanie Emaili
{% endblock %}

{% block page_actions %}
    <div class="d-flex justify-content-end gap-2 mb-3">
        <button class="btn admin-btn" onclick="showCampaignModal()">
            <i class="fas fa-plus me-2"></i>Nowa kampania
        </button>
        <button class="btn admin-btn-danger" id="bulkDeleteBtn" onclick="bulkDeleteManager.showBulkDeleteModal()" style="display: none;">
            <i class="fas fa-trash me-2"></i>Usuń Zaznaczone
        </button>
    </div>
{% endblock %}

{% block content %}
    <!-- Campaigns Table -->
    <div class="admin-card">
        <div class="admin-card-body">
                    <div class="table-responsive">
                        <table class="table admin-table">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAll" onchange="bulkDeleteManager.toggleSelectAll()">
                                    </th>
                                    <th>Nazwa</th>
                                    <th>Temat</th>
                                    <th>Status</th>
                                    <th>Odbiorcy</th>
                                    <th>Wysłane</th>
                                    <th>Utworzono</th>
                                    <th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="campaignsTableBody">
                                <tr>
                                    <td colspan="8" class="text-center text-muted">
                                        <i class="fas fa-spinner fa-spin me-2"></i>Ładowanie...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
            <!-- Pagination -->
            <div id="pagination" class="mt-3"></div>
        </div>
    </div>

<!-- Campaign Modal -->
<div class="modal fade" id="campaignModal" tabindex="-1" aria-labelledby="campaignModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="campaignModalLabel">Kampania Emaila</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="campaignForm">
                <div class="modal-body">
                    <input type="hidden" id="campaign_id" name="campaign_id">
                    
                    <div class="mb-3">
                        <label for="campaign_name" class="form-label">Nazwa kampanii *</label>
                        <input type="text" class="form-control" id="campaign_name" name="campaign_name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="campaign_subject" class="form-label">Temat emaila *</label>
                        <input type="text" class="form-control" id="campaign_subject" name="campaign_subject" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="campaign_template" class="form-label">Szablon emaila *</label>
                        <select class="form-select" id="campaign_template" name="campaign_template" required onchange="handleTemplateChange()">
                            <option value="">Wybierz szablon</option>
                        </select>
                        <div class="form-text">Wybierz szablon, który będzie używany do generowania emaili</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="campaign_groups" class="form-label">Grupy odbiorców *</label>
                        <select class="form-select" id="campaign_groups" name="campaign_groups" multiple required>
                            <option value="">Wybierz grupy</option>
                        </select>
                        <div class="form-text">Przytrzymaj Ctrl (Cmd na Mac) aby wybrać wiele grup</div>
                    </div>
                    
                    <div id="templateVariables" class="mb-3" style="display: none;">
                        <label class="form-label">Treść do wstawienia w szablon</label>
                        <div id="variablesContainer">
                            <!-- Variables will be loaded here dynamically -->
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Podgląd emaila</label>
                        <div id="emailPreview" class="border p-3 bg-light" style="min-height: 200px;">
                            <p class="text-muted">Wybierz szablon aby zobaczyć podgląd</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn admin-btn-outline" data-bs-dismiss="modal">Anuluj</button>
                    <button type="button" class="btn admin-btn" onclick="saveCampaign()">Zapisz kampanię</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/utils/paginate.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin/email_campaigns.js') }}?v={{ range(1000000, 9999999) | random }}"></script>
{% endblock %}
